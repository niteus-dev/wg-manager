# WG Manager с авторизацией через PocketID

Это приложение для управления клиентами WireGuard с возможностью авторизации через PocketID.

## Настройка авторизации

### Включение/выключение авторизации

В файле `config.py` установите параметр `AUTH_ENABLED`:
- `True` - включить авторизацию через PocketID
- `False` - отключить авторизацию (приложение работает как раньше)

### Настройка PocketID

Для работы с PocketID необходимо установить следующие параметры в `config.py`:

```python
# Параметры для интеграции с PocketID
CLIENT_ID = os.environ.get("POCKETID_CLIENT_ID", "your_client_id_here")
CLIENT_SECRET = os.environ.get("POCKETID_CLIENT_SECRET", "your_client_secret_here")
REDIRECT_URI = os.environ.get("POCKETID_REDIRECT_URI", "http://localhost:8080/callback")
AUTH_URL = "https://pocketid.ru/oauth/authorize"
TOKEN_URL = "https://pocketid.ru/oauth/token"
USERINFO_URL = "https://pocketid.ru/api/v1/userinfo"
```

Рекомендуется устанавливать эти параметры через переменные окружения:

```bash
export POCKETID_CLIENT_ID="ваш_client_id"
export POCKETID_CLIENT_SECRET="ваш_client_secret"
export POCKETID_REDIRECT_URI="http://ваш_домен/callback"
export SECRET_KEY="ваш_секретный_ключ_для_сессий"
```

## Как это работает

### При включенной авторизации (AUTH_ENABLED = True):

1. Все маршруты (кроме `/login`, `/callback` и статических файлов) требуют авторизации
2. При попытке доступа к защищенному маршруту незалогиненный пользователь перенаправляется на `/login`
3. Маршрут `/login` перенаправляет пользователя на страницу авторизации PocketID
4. После успешной авторизации пользователь возвращается на маршрут `/callback`
5. В `/callback` происходит обмен кода авторизации на токен доступа и получение информации о пользователе
6. Информация о пользователе сохраняется в сессии
7. Пользователь перенаправляется на главную страницу
8. При выходе маршрут `/logout` очищает сессию и перенаправляет на страницу входа

### При выключенной авторизации (AUTH_ENABLED = False):

Приложение работает как раньше, без какой-либо проверки авторизации.

## Пример использования

1. Установите параметры авторизации через переменные окружения
2. Установите `AUTH_ENABLED = True` в `config.py`
3. Запустите приложение: `python app.py`
4. Откройте в браузере `http://localhost:8080`
5. Вы будете автоматически перенаправлены на страницу входа
6. Нажмите на кнопку входа через PocketID
7. После успешной авторизации вы попадете на главную страницу приложения

## API маршруты

- `GET /` - Главная страница со списком клиентов (требует авторизации если включена)
- `POST /` - Создание нового клиента (требует авторизации если включена)
- `GET /api/clients` - Получение списка клиентов в формате JSON (требует авторизации если включена)
- `POST /api/clients` - Создание нового клиента через API (требует авторизации если включена)
- `GET /api/client/<client_name>` - Получение конфигурации клиента (требует авторизации если включена)
- `GET /client/<client_name>` - Скачивание конфигурационного файла клиента (требует авторизации если включена)
- `POST /client/<name>/delete` - Удаление клиента (требует авторизации если включена)
- `POST /api/client/<client_name>/suspend` - Отключение клиента (требует авторизации если включена)
- `POST /api/client/<client_name>/unsuspend` - Включение клиента (требует авторизации если включена)
- `POST /api/client/<client_name>/delete` - Удаление клиента через API (требует авторизации если включена)
- `GET /login` - Страница входа через PocketID (доступна всегда)
- `GET /callback` - Обработчик ответа от PocketID (доступен всегда)
- `GET /logout` - Выход из системы (требует авторизации если включена)

## Зависимости

Убедитесь, что установлены все необходимые зависимости:

```bash
pip install flask requests
